<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Real Revenue Stats</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-900 text-white p-8">
    <div class="max-w-4xl mx-auto">
        <h1 class="text-3xl font-bold mb-8 text-center">Revenue Tracker (Live DB)</h1>
        
        <div class="grid grid-cols-2 gap-4 mb-8">
            <div class="bg-gray-800 p-6 rounded-xl border border-gray-700">
                <div class="text-gray-400">Total Orders</div>
                <div class="text-4xl font-bold" id="count">Loading...</div>
            </div>
            <div class="bg-gray-800 p-6 rounded-xl border border-gray-700">
                <div class="text-gray-400">Revenue</div>
                <div class="text-4xl font-bold text-green-400" id="money">---</div>
            </div>
        </div>

        <div class="bg-gray-800 rounded-xl overflow-hidden border border-gray-700">
            <table class="w-full text-left text-sm">
                <thead class="bg-gray-700 text-gray-400">
                    <tr><th class="p-4">Email</th><th class="p-4">Time</th></tr>
                </thead>
                <tbody id="list" class="divide-y divide-gray-700"></tbody>
            </table>
        </div>
        <div id="error-msg" class="text-red-500 text-center mt-4 text-xs hidden"></div>
    </div>

    <script>
        // ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡
        // ã€ä¸€å®šè¦æŠŠè¿™ä¸ªæ¢æˆä½ çš„ RENDER åœ°å€ï¼ã€‘
        const API_BASE = 'https://ä½ çš„é¡¹ç›®å.onrender.com'; 
        // ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†

        async function load() {
            try {
                // è¿æ¥ Render äº‘ç«¯ï¼Œç”± Render å»è¿æ•°æ®åº“
                const res = await fetch(`${API_BASE}/api/stats/purchases`);
                const json = await res.json();
                
                if(json.status === 'success') {
                    const data = json.data;
                    document.getElementById('count').innerText = data.total_intents;
                    document.getElementById('money').innerText = '$' + (data.total_intents * 99).toLocaleString();
                    
                    const list = document.getElementById('list');
                    if(data.recent_purchases.length === 0) {
                        list.innerHTML = '<tr><td colspan="2" class="p-4 text-gray-500">æ•°æ®åº“æš‚æ— æ•°æ®</td></tr>';
                    } else {
                        list.innerHTML = data.recent_purchases.map(p => `
                            <tr>
                                <td class="p-4 font-mono text-blue-300">${p.user_email}</td>
                                <td class="p-4 text-gray-400">${new Date(p.created_at).toLocaleString()}</td>
                            </tr>
                        `).join('');
                    }
                } else {
                    throw new Error(json.msg || "API Error");
                }
            } catch(e) {
                document.getElementById('count').innerText = "Error";
                document.getElementById('error-msg').innerText = "è¿æ¥å¤±è´¥: " + e.message + " (è¯·æ£€æŸ¥ Render URL æ˜¯å¦å¡«å¯¹)";
                document.getElementById('error-msg').classList.remove('hidden');
            }
        }
        load();
        // æ¯ 10 ç§’è‡ªåŠ¨åˆ·æ–°ä¸€æ¬¡ï¼Œè®©ä½ çœ‹ç€çˆ½
        setInterval(load, 10000);
    </script>
</body>
</html>
