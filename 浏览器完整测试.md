# PropKit 浏览器端到端测试指南

## 🎯 测试目标

从浏览器访问域名开始，完整测试从 landing page → webhook → GPU计算 → 数据上传 → dashboard 显示的整个流程。

---

## 📋 测试前准备

### 1. 确保服务运行

**方法一：使用一键启动**
```
双击: 一键启动.bat
```

**方法二：手动启动两个窗口**

**窗口 1 - Cloudflared:**
```cmd
cd C:\Users\Administrator\Desktop\baseball\netlify_deploy\netlify_deploy1
cloudflared tunnel --config config.yml run 3090-Home
```

**窗口 2 - Python 后端:**
```cmd
cd C:\Users\Administrator\Desktop\baseball\netlify_deploy\netlify_deploy1
C:\ProgramData\Anaconda3\python.exe main.py
```

### 2. 验证服务状态

运行验证脚本确认服务正常：
```cmd
.\verify_flow.ps1
```

或检查：
- ✅ Cloudflared 窗口显示 "Connected"
- ✅ Python 窗口显示 "🚀 后端已就绪，等待 Cloudflare 隧道连接..."

---

## 🧪 完整测试步骤

### 步骤 1: 打开 Landing Page

1. 打开浏览器（Chrome/Edge/Firefox）
2. 访问：**https://propkitai.tech/landing.html**
3. 确认页面正常加载
   - 看到 "The Science of Certainty" 标题
   - 看到 "Request Access" 按钮

### 步骤 2: 点击 Request Access

1. 点击 **"Request Access"** 按钮
2. 应该弹出模态窗口
3. 窗口显示：
   - "🎉 Special Offer: 1 Month Free Trial"
   - 邮箱输入框
   - "ACTIVATE FREE TRIAL" 按钮

### 步骤 3: 输入邮箱并提交

1. 在输入框中输入测试邮箱（例如：`test_browser_2026@example.com`）
2. 点击 **"ACTIVATE FREE TRIAL"** 按钮
3. 应该看到提示：
   - "✅ Free trial activated! Processing your data..."
   - "You will be redirected to your dashboard shortly."

### 步骤 4: 观察后端处理

**在 Python 后端窗口，你应该看到：**

```
⚡ [3090] 启动任务: test_browser_2026@example.com
  运行 GPU 计算: x64/Debug/CudaRuntime1.exe
  ✅ GPU 计算完成
  运行 JSON 导出: C:\ProgramData\Anaconda3\python.exe export_json.py
  ✅ JSON 导出完成
✅ 同步完成，状态码: 201
```

**注意：**
- GPU 计算可能需要 30-120 秒
- 请耐心等待，不要关闭窗口

### 步骤 5: 自动跳转到 Dashboard

1. 等待 1-2 秒后，浏览器应该自动跳转到：
   - `https://propkitai.tech/dashboard.html?email=test_browser_2026@example.com`

2. Dashboard 应该显示：
   - 标题："COMMANDER ALPHA"
   - 图表区域（ECharts 图表）
   - 数据统计（右上角）

### 步骤 6: 验证数据

**Dashboard 应该显示：**
- ✅ 图表正常渲染
- ✅ 显示数据点
- ✅ 右上角显示统计信息：
  - Total Analyzed: 288136
  - Target Count: 26906
  - Top Reason: 0

---

## 🔍 故障排查

### 问题 1: 点击按钮无反应

**检查：**
- 浏览器控制台是否有错误（F12 → Console）
- 网络连接是否正常
- API 地址是否正确：`https://api.propkitai.tech/api/webhook`

**解决：**
- 检查 Cloudflared 是否运行
- 检查 API 是否可访问

### 问题 2: 提交后没有跳转

**检查：**
- Python 后端窗口是否有错误
- 浏览器控制台是否有错误
- 网络请求是否成功（F12 → Network）

**解决：**
- 检查 webhook 是否被调用
- 检查后端日志

### 问题 3: Dashboard 显示 "Processing Data..."

**检查：**
- Supabase 中是否有数据
- 邮箱地址是否匹配
- 数据是否已上传

**解决：**
- 等待 GPU 计算完成（可能需要 2-3 分钟）
- 检查 Python 后端窗口的日志
- 运行诊断脚本检查 Supabase

### 问题 4: Dashboard 显示错误

**检查：**
- 浏览器控制台错误（F12 → Console）
- Supabase 连接是否正常
- API Key 是否正确

**解决：**
- 检查 dashboard.html 中的 Supabase 配置
- 运行诊断脚本验证数据库

---

## ✅ 成功标准

完整测试成功的标志：

1. ✅ Landing page 正常加载
2. ✅ 点击按钮弹出模态窗口
3. ✅ 输入邮箱并提交成功
4. ✅ 看到激活提示
5. ✅ Python 后端开始处理任务
6. ✅ GPU 计算完成（后端窗口显示）
7. ✅ JSON 导出完成（后端窗口显示）
8. ✅ 数据上传成功（状态码 201）
9. ✅ 自动跳转到 dashboard
10. ✅ Dashboard 显示图表和数据

---

## 📊 测试检查清单

- [ ] 服务运行正常（Cloudflared + Python）
- [ ] 可以访问 https://propkitai.tech/landing.html
- [ ] 点击 "Request Access" 按钮有反应
- [ ] 模态窗口正常显示
- [ ] 可以输入邮箱
- [ ] 提交后看到激活提示
- [ ] Python 后端开始处理
- [ ] GPU 计算完成
- [ ] JSON 导出完成
- [ ] 数据上传成功
- [ ] 自动跳转到 dashboard
- [ ] Dashboard 显示图表
- [ ] Dashboard 显示数据统计

---

## 🎬 测试视频录制建议

如果可能，建议录制测试过程：
1. 打开浏览器开发者工具（F12）
2. 切换到 Network 标签
3. 开始录制
4. 执行完整测试流程
5. 查看网络请求和响应

---

## 📝 测试记录

**测试时间：** _______________

**测试邮箱：** _______________

**测试结果：**
- [ ] 完全成功
- [ ] 部分成功（说明问题）
- [ ] 失败（说明错误）

**备注：**
_________________________________________________
