#!/bin/sh
# Git pre-commit hook: æ£€æŸ¥ .gitignore è§„åˆ™
# é˜²æ­¢å°†åº”è¯¥å¿½ç•¥çš„æ–‡ä»¶æ·»åŠ åˆ°æš‚å­˜åŒº

echo "ğŸ” æ£€æŸ¥ .gitignore è§„åˆ™..."

# è·å–æš‚å­˜åŒºçš„æ–‡ä»¶åˆ—è¡¨
staged_files=$(git diff --cached --name-only)

# è¯»å– .gitignore è§„åˆ™
if [ -f .gitignore ]; then
    while IFS= read -r line; do
        # è·³è¿‡ç©ºè¡Œå’Œæ³¨é‡Š
        if [ -z "$line" ] || [ "${line#\#}" != "$line" ]; then
            continue
        fi
        
        # æ£€æŸ¥æ¯ä¸ªæš‚å­˜æ–‡ä»¶æ˜¯å¦åŒ¹é… .gitignore è§„åˆ™
        for file in $staged_files; do
            # ä½¿ç”¨ git check-ignore æ£€æŸ¥æ–‡ä»¶æ˜¯å¦åº”è¯¥è¢«å¿½ç•¥
            if git check-ignore -q "$file"; then
                echo "âŒ é”™è¯¯: æ–‡ä»¶ '$file' åŒ¹é… .gitignore è§„åˆ™ï¼Œä¸åº”è¢«æäº¤ï¼"
                echo "   è§„åˆ™: $line"
                exit 1
            fi
        done
    done < .gitignore
fi

echo "âœ… .gitignore æ£€æŸ¥é€šè¿‡"
exit 0
